{
  "project": "Anywhere (gemini-nexus)",
  "version": "4.0.0",
  "lastScanTimestamp": "2026-01-03T17:12:45+08:00",
  "summary": {
    "totalFiles": 135,
    "scannedFiles": 135,
    "coveragePercent": 100,
    "ignored": {
      "node_modules": true,
      "dist": true,
      ".git": true,
      "vite-generated": true
    }
  },
  "modules": [
    {
      "name": "background",
      "path": "background/",
      "type": "service-worker",
      "language": "JavaScript",
      "entryPoint": "background/index.js",
      "responsibility": "后台服务 Worker，管理 Gemini API 调用、会话、认证、浏览器控制",
      "interfaces": [
        "setupMessageListener (消息监听器)",
        "setupContextMenus (右键菜单)"
      ],
      "keyDependencies": [
        "services/gemini_api.js",
        "services/auth.js",
        "chrome.runtime",
        "chrome.tabs",
        "chrome.debugger",
        "chrome.storage"
      ],
      "testCoverage": "无",
      "importantFiles": [
        "background/index.js",
        "background/managers/session_manager.js",
        "background/managers/auth_manager.js",
        "background/managers/control_manager.js",
        "background/managers/mcp_manager.js",
        "background/managers/image_manager.js",
        "background/managers/log_manager.js",
        "background/handlers/session.js",
        "background/handlers/ui.js",
        "background/messages.js",
        "background/menus.js",
        "background/control/connection.js",
        "background/control/actions.js",
        "background/control/snapshot.js"
      ],
      "gaps": [
        "缺少单元测试",
        "缺少 API Mock 测试",
        "缺少错误处理覆盖测试"
      ]
    },
    {
      "name": "content",
      "path": "content/",
      "type": "content-script",
      "language": "JavaScript",
      "entryPoint": "content/index.js",
      "responsibility": "注入到网页的脚本，提供浮动工具栏、文本选择、截图裁剪",
      "interfaces": [
        "chrome.runtime.onMessage (接收消息)",
        "document.addEventListener (快捷键监听)"
      ],
      "keyDependencies": [
        "content/toolbar/controller.js",
        "content/overlay.js",
        "chrome.runtime",
        "chrome.storage"
      ],
      "testCoverage": "无",
      "importantFiles": [
        "content/index.js",
        "content/overlay.js",
        "content/selection.js",
        "content/toolbar/controller.js",
        "content/toolbar/bridge.js",
        "content/toolbar/view/index.js",
        "content/toolbar/ui/renderer.js",
        "content/toolbar/styles/index.js",
        "content/toolbar/crop.js",
        "content/toolbar/image.js"
      ],
      "gaps": [
        "缺少 E2E 测试",
        "缺少样式回归测试",
        "缺少不同网站的兼容性测试"
      ]
    },
    {
      "name": "sandbox",
      "path": "sandbox/",
      "type": "sandbox-ui",
      "language": "JavaScript",
      "entryPoint": "sandbox/index.js",
      "responsibility": "安全的 UI 渲染环境，渲染 Markdown、Mermaid、LaTeX 等内容",
      "interfaces": [
        "window.addEventListener('message') (接收消息)",
        "window.parent.postMessage (发送消息)"
      ],
      "keyDependencies": [
        "Marked.js (Markdown 解析)",
        "Highlight.js (代码高亮)",
        "KaTeX (LaTeX 渲染)",
        "Mermaid (图表渲染)",
        "Markmap (思维导图)",
        "D3.js (数据可视化)"
      ],
      "testCoverage": "无",
      "importantFiles": [
        "sandbox/index.js",
        "sandbox/boot/app.js",
        "sandbox/boot/renderer.js",
        "sandbox/boot/messaging.js",
        "sandbox/controllers/app_controller.js",
        "sandbox/controllers/session_flow.js",
        "sandbox/controllers/message_handler.js",
        "sandbox/controllers/prompt.js",
        "sandbox/ui/layout.js",
        "sandbox/ui/chat.js",
        "sandbox/ui/settings.js",
        "sandbox/render/pipeline.js",
        "sandbox/render/content.js",
        "sandbox/render/message.js",
        "sandbox/theme_init.js"
      ],
      "gaps": [
        "缺少单元测试（渲染管道）",
        "缺少快照测试（UI 组件）",
        "缺少性能测试（大量消息渲染）"
      ]
    },
    {
      "name": "sidepanel",
      "path": "sidepanel/",
      "type": "bridge",
      "language": "JavaScript",
      "entryPoint": "sidepanel/index.js",
      "responsibility": "侧边栏桥接层，连接 Sandbox 和 Background",
      "interfaces": [
        "window.addEventListener('message') (接收 Sandbox 消息)",
        "chrome.runtime.onMessage (接收 Background 消息)",
        "chrome.runtime.sendMessage (发送到 Background)",
        "iframe.contentWindow.postMessage (发送到 Sandbox)"
      ],
      "keyDependencies": [
        "chrome.storage.local",
        "chrome.runtime",
        "chrome.tabs",
        "html2canvas (PNG 导出)"
      ],
      "testCoverage": "无",
      "importantFiles": [
        "sidepanel/index.html",
        "sidepanel/index.js"
      ],
      "gaps": [
        "缺少集成测试（消息转发流程）",
        "缺少性能测试（首屏加载时间）",
        "缺少边界测试（iframe 加载失败等）"
      ]
    },
    {
      "name": "services",
      "path": "services/",
      "type": "api-layer",
      "language": "JavaScript",
      "entryPoint": "services/gemini_api.js",
      "responsibility": "封装与 Gemini API 的通信逻辑",
      "interfaces": [
        "sendGeminiMessage (发送消息)",
        "fetchRequestParams (获取认证参数)",
        "uploadFile (上传文件)",
        "fetchGemsList (获取 Gem 列表)",
        "fetchModelsList (获取模型列表)"
      ],
      "keyDependencies": [
        "fetch API",
        "chrome.tabs",
        "chrome.scripting"
      ],
      "testCoverage": "无",
      "importantFiles": [
        "services/gemini_api.js",
        "services/auth.js",
        "services/upload.js",
        "services/parser.js",
        "services/gems_api.js",
        "services/models_api.js",
        "services/session_api.js"
      ],
      "gaps": [
        "缺少单元测试（解析器）",
        "缺少集成测试（Mock API）",
        "缺少错误处理测试（网络失败等）"
      ]
    },
    {
      "name": "lib",
      "path": "lib/",
      "type": "utilities",
      "language": "JavaScript",
      "entryPoint": "无（工具库）",
      "responsibility": "通用工具函数和常量",
      "interfaces": [
        "constants (常量定义)",
        "messaging (消息通信封装)",
        "logger (日志记录)",
        "utils (工具函数)",
        "crop_utils (裁剪工具)",
        "watermark_remover (水印移除)"
      ],
      "keyDependencies": [
        "Canvas API"
      ],
      "testCoverage": "无",
      "importantFiles": [
        "lib/constants.js",
        "lib/messaging.js",
        "lib/logger.js",
        "lib/utils.js",
        "lib/crop_utils.js",
        "lib/watermark_remover.js"
      ],
      "gaps": [
        "缺少单元测试（工具函数）",
        "缺少性能测试（图像处理）"
      ]
    },
    {
      "name": "css",
      "path": "css/",
      "type": "styles",
      "language": "CSS",
      "entryPoint": "无（样式文件）",
      "responsibility": "全局样式文件",
      "interfaces": [],
      "keyDependencies": [],
      "testCoverage": "无",
      "importantFiles": [
        "css/base.css",
        "css/components.css",
        "css/header.css",
        "css/sidebar.css",
        "css/chat.css",
        "css/input.css"
      ],
      "gaps": [
        "缺少样式回归测试"
      ]
    }
  ],
  "rootFiles": [
    "manifest.json (扩展清单)",
    "package.json (包管理)",
    "vite.config.js (构建配置)",
    "tsconfig.json (TypeScript 配置)",
    ".gitignore (忽略规则)",
    "README.md (项目说明)",
    "logo.png (扩展图标)"
  ],
  "buildSystem": {
    "tool": "Vite 6.2.0",
    "entries": [
      "background/index.js (Service Worker)",
      "sandbox/index.html (Sandbox UI)",
      "sidepanel/index.html (Sidepanel UI)"
    ],
    "outputDir": "dist/",
    "contentScriptsCopied": true,
    "staticFilesCopied": true
  },
  "testingStatus": {
    "unitTests": "无",
    "integrationTests": "无",
    "e2eTests": "无",
    "coverage": "0%",
    "recommendations": [
      "添加 Vitest 或 Jest 单元测试框架",
      "添加 Puppeteer 或 Playwright E2E 测试",
      "为核心 API 调用添加 Mock 测试",
      "为渲染管道添加快照测试",
      "为消息通信流程添加集成测试"
    ]
  },
  "qualityTools": {
    "linter": "无（建议添加 ESLint）",
    "formatter": "无（建议添加 Prettier）",
    "typeChecker": "TypeScript (tsconfig.json 存在但未启用)",
    "recommendations": [
      "添加 ESLint 代码规范检查",
      "添加 Prettier 代码格式化",
      "启用 TypeScript 类型检查（或转为纯 JS）",
      "添加 pre-commit hooks（Husky + lint-staged）"
    ]
  },
  "architecture": {
    "pattern": "消息驱动架构（Chrome Extension Messaging）",
    "layers": [
      "Extension Runtime (Chrome API)",
      "Background Service Worker (后台核心逻辑)",
      "Content Scripts (网页注入脚本)",
      "Sidepanel (侧边栏桥接层)",
      "Sandbox (安全的 UI 渲染环境)"
    ],
    "communication": [
      "Background ←→ Content: chrome.runtime.sendMessage",
      "Background ←→ Sidepanel: chrome.runtime.sendMessage",
      "Sidepanel ←→ Sandbox: window.postMessage"
    ]
  },
  "dataFlow": {
    "userInput": "Content/Sidepanel → Background → Services (Gemini API) → Background → Sidepanel → Sandbox → UI",
    "storage": "chrome.storage.local (会话、配置、认证参数)",
    "cache": "localStorage (主题、语言缓存)"
  },
  "securityFeatures": [
    "Sandbox 隔离（避免 XSS）",
    "CSP 策略（Content Security Policy）",
    "权限最小化（仅申请必要权限）",
    "本地处理（数据不上传第三方服务器）"
  ],
  "nextSteps": [
    "补充单元测试覆盖（优先：services/parser.js、lib/utils.js）",
    "添加 E2E 测试（优先：对话流程、截图功能）",
    "添加 ESLint 和 Prettier",
    "优化构建配置（启用 Tree Shaking、Code Splitting）",
    "添加错误监控（Sentry 或自定义日志上报）",
    "文档完善（API 文档、开发指南）"
  ],
  "truncated": false,
  "scanNotes": [
    "全仓扫描完成，覆盖所有核心模块",
    "已生成各模块 CLAUDE.md 文档",
    "已生成根级 CLAUDE.md 和索引文件",
    "忽略了 node_modules、dist、.git 等目录",
    "建议下一步：添加自动化测试框架"
  ]
}
